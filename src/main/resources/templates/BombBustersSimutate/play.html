<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bomb Busters Simutate</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/bomb-busters.css}" />
</head>
<body th:attr="data-player-name=${session.playerName}">
    <div class="page">
        <header class="hero">
            <div class="hero-top">
                <div class="hero-version-block">
                    <span class="hero-version">v1.0.1</span>
                    <button type="button" class="hero-version-button" id="release-notes-button">詳細</button>
                </div>
                <label class="theme-toggle" for="theme-toggle">
                    <span class="toggle-label">ライト</span>
                    <input type="checkbox" id="theme-toggle" aria-label="ライトモード切り替え">
                    <span class="toggle-track" aria-hidden="true"></span>
                </label>
                <div class="hero-badge">
                    <span>ROOM 01</span>
                    <strong>同期中</strong>
                </div>
                <button type="button" class="logout-button" id="logout-button">ログアウト</button>
            </div>
            <div class="hero-content">
                <p class="eyebrow">Bomb Busters Simutate</p>
                <h1>『ボムバスターズ』シミュレーター</h1>
                                <div class="rule-grid">
                    <section class="rule-card">
                        <h3>ゲームの準備</h3>
                        <ul class="rule-list">
                            <li>各プレイヤーは、個人装備「フツーノ探知機」を1個所持して開始する。</li>
                            <li>各プレイヤーに全コードが均等に配られる。整数のコードは1種4本、それ以外のコードは1種1本のみである。</li>
                        </ul>
                    </section>
                    <section class="rule-card">
                        <h3>自分の手番</h3>
                        <p>以下のアクションから1つを選んで実行する。</p>
                        <ul class="rule-list">
                            <li>① 相手のコードを1本選んで数字を宣言する。</li>
                            <p style="padding-left:1em;">正解：相手のコードを切断（公開）し、自分も同じ数字のコード1本を切断する。</li>
                            <p style="padding-left:1em;">不正解：起爆ダイヤルが1減少し、相手は正しい数字のトークンを置く。</li>
                            <li>② 自分の手札にある、同じ数字のコード4本（黄色4本も可）を切断する。</li>
                            <li>③ （その数字が既に2本切断済みであれば、）自分の手札にある、同じ数字のコード2本（黄色2本も可）を切断する。</li>
                            <li>④ 自分の未切断コードが赤のみなら、それらをすべて切断する。</li>
                            <li style="font-size: 70%;">※ 自分のコードにない数字は宣言できない。黄色は黄色同士で切断する。</li>
                            <li>⑤ （自分の手札にある全ての手札が切断されていれば、）手番をスキップする。</li>
                        </ul>
                    </section>
                    <section class="rule-card">
                        <h3>ゲーム終了</h3>
                        <ul class="rule-list">
                            <li>全てのコードが切断されると、ミッション成功。</li>
                            <li>起爆ダイヤルが0になったり、赤色のコードを切らざるをえない状況になった場合、ミッション失敗。</li>
                        </ul>
                        <br>
                        <h3>その他</h3>
                        <ul class="rule-list">
                            <li>個人装備以外の装備カードは、対応する数字のコードを2本以上切断すれば、使用できるようになる。</li>
                            <li>同じ数字のコードが4本切断された際（黄色/赤は除く）、「山札に含まれる数字」内の数字が緑色に光る。</li>
                        </ul>
                    </section>
                </div>
            </div>
        </header>

        <main class="content play">
            <section class="panel board-panel">
                <div class="status-row">
                    <div>
                        <span class="label">プレイヤー</span>
                        <span id="player-label">未設定</span>
                    </div>
                    <div>
                        <span class="label">ステータス</span>
                        <span id="connection-label">未接続</span>
                    </div>
                    <div>
                        <span class="label">ゲーム</span>
                        <span class="status-inline">
                            <span id="game-status">準備中</span>
                            <button type="button" class="status-button" id="log-button">ログ</button>
                        </span>
                    </div>
                </div>
                <div class="log-panel hidden" id="log-panel">
                    <div class="log-header">
                        <span>ログ</span>
                        <button type="button" class="log-close" id="log-close">閉じる</button>
                    </div>
                    <ul class="log-list" id="log-list"></ul>
                </div>
                <div class="game-actions">
                    <button type="button" id="start-button">ゲームスタート</button>
                    <button type="button" id="end-button" class="hidden">ゲーム強制終了</button>
                    <span class="game-note" id="game-note">プレイヤー1のみ開始できます。</span>
                </div>
                <div class="notice" id="notice"></div>
                <div class="action-panel" id="action-panel">
                    <button type="button" class="action-button" id="action-target">1.相手を選んで切断</button>
                    <button type="button" class="action-button" id="action-reveal4">2.同数4本切断</button>
                    <button type="button" class="action-button" id="action-reveal2">3.同数2本切断</button>
                    <button type="button" class="action-button" id="action-reveal-reds">4.赤のみ切断</button>
                    <button type="button" class="action-button" id="action-skip">5.手番スキップ</button>
                </div>
                <div class="options-panel" id="options-panel">
                    <div class="option-block option-yellow">
                        <h3>黄色数字設定</h3>
                        <div class="option-grid">
                            <label>最小値<input type="number" id="yellow-min" value="1" min="1" max="11"></label>
                            <label>最大値<input type="number" id="yellow-max" value="11" min="1" max="11"></label>
                            <label>プール本数<input type="number" id="yellow-pool" value="0" min="0" max="4"></label>
                            <label>抽出本数<input type="number" id="yellow-draw" value="0" min="0" max="4" step="2"></label>
                        </div>
                    </div>
                    <div class="option-block option-red">
                        <h3>赤色数字設定</h3>
                        <div class="option-grid">
                            <label>最小値<input type="number" id="red-min" value="1" min="1" max="11"></label>
                            <label>最大値<input type="number" id="red-max" value="11" min="1" max="11"></label>
                            <label>プール本数<input type="number" id="red-pool" value="0" min="0" max="3"></label>
                            <label>抽出本数<input type="number" id="red-draw" value="0" min="0" max="3"></label>
                        </div>
                    </div>
                    <div class="option-block option-other">
                        <div class="option-header">
                            <h3>その他設定</h3>
                            <button type="button" class="option-toggle" id="other-toggle" aria-expanded="false">
                                表示
                            </button>
                        </div>
                        <div class="option-body is-collapsed" id="other-body">
                            <div class="option-grid option-grid-wide">
                                <label>数字コード最小値<input type="number" id="card-min" value="1" min="1" max="1"></label>
                                <label>数字コード最大値<input type="number" id="card-max" value="12" min="6" max="12"></label>
                            </div>
                            <div class="option-equip">
                                <span class="option-sub">除外する装備カード</span>
                                <div class="option-checks" id="exclude-equipments">
                                    <label><input type="checkbox" name="exclude-equipment" value="1">1</label>
                                    <label><input type="checkbox" name="exclude-equipment" value="2">2</label>
                                    <label><input type="checkbox" name="exclude-equipment" value="3">3</label>
                                    <label><input type="checkbox" name="exclude-equipment" value="4">4</label>
                                    <label><input type="checkbox" name="exclude-equipment" value="5">5</label>
                                    <label><input type="checkbox" name="exclude-equipment" value="6">6</label>
                                    <label><input type="checkbox" name="exclude-equipment" value="7">7</label>
                                    <label><input type="checkbox" name="exclude-equipment" value="8">8</label>
                                    <label><input type="checkbox" name="exclude-equipment" value="9">9</label>
                                    <label><input type="checkbox" name="exclude-equipment" value="10">10</label>
                                    <label><input type="checkbox" name="exclude-equipment" value="11">11</label>
                                    <label><input type="checkbox" name="exclude-equipment" value="12">12</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="board-wrapper">
                    <div class="hands-grid" aria-label="配られたコード">
                        <div class="hand-slot" id="hand-container-1">
                            <span class="hand-label" id="hand-label-1"></span>
                            <span class="parent-icon" id="parent-icon-1" aria-label="隊長">👑</span>
                            <span class="hand-name" id="player-name-1">未参加</span>
                            <ul class="hand-list" id="hand-slot-1"></ul>
                            <button type="button" class="hand-detector" id="detector-1" aria-label="フツーノ探知機" data-equipment-number="0">
                                <img class="detector-icon" src="/img/image0.png" alt="">
                                <span class="sr-only">フツーノ探知機</span>
                                <div class="equipment-tooltip detector-tooltip" role="tooltip" aria-hidden="true">
                                    <div class="tooltip-title">-</div>
                                    <div class="tooltip-row tooltip-number-row"><span class="tooltip-label">番号</span><span class="detector-tooltip-number">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">装備名</span><span class="detector-tooltip-name">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">効果</span><span class="detector-tooltip-effect">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">使用可能タイミング</span><span class="detector-tooltip-timing">-</span></div>
                                </div>
                            </button>
                        </div>
                        <div class="hand-slot" id="hand-container-2">
                            <span class="hand-label" id="hand-label-2"></span>
                            <span class="parent-icon" id="parent-icon-2" aria-label="隊長">👑</span>
                            <span class="hand-name" id="player-name-2">未参加</span>
                            <ul class="hand-list" id="hand-slot-2"></ul>
                            <button type="button" class="hand-detector" id="detector-2" aria-label="フツーノ探知機" data-equipment-number="0">
                                <img class="detector-icon" src="/img/image0.png" alt="">
                                <span class="sr-only">フツーノ探知機</span>
                                <div class="equipment-tooltip detector-tooltip" role="tooltip" aria-hidden="true">
                                    <div class="tooltip-title">-</div>
                                    <div class="tooltip-row tooltip-number-row"><span class="tooltip-label">番号</span><span class="detector-tooltip-number">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">装備名</span><span class="detector-tooltip-name">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">効果</span><span class="detector-tooltip-effect">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">使用可能タイミング</span><span class="detector-tooltip-timing">-</span></div>
                                </div>
                            </button>
                        </div>
                        <div class="mid-panel game-only" id="mid-panel">
                            <div class="mist-panel">
                                <span class="mid-label">起爆ダイヤル</span>
                                <span class="mist-value" id="mist-value">4</span>
                            </div>
                            <div class="equipment-panel">
                                <span class="mid-label">装備カード</span>
                                <div class="equipment-buttons">
                                    <button type="button" class="equipment-button" id="equipment-1">
                                        <span class="equipment-label">-</span>
                                        <img class="equipment-image" src="/img/image1.png" alt="装備1">
                                    </button>
                                    <button type="button" class="equipment-button" id="equipment-2">
                                        <span class="equipment-label">-</span>
                                        <img class="equipment-image" src="/img/image2.png" alt="装備2">
                                    </button>
                                    <button type="button" class="equipment-button" id="equipment-3">
                                        <span class="equipment-label">-</span>
                                        <img class="equipment-image" src="/img/image1.png" alt="装備3">
                                    </button>
                                    <button type="button" class="equipment-button" id="equipment-4">
                                        <span class="equipment-label">-</span>
                                        <img class="equipment-image" src="/img/image2.png" alt="装備4">
                                    </button>
                                </div>
                                <div class="equipment-tooltip" id="equipment-tooltip" role="tooltip" aria-hidden="true">
                                    <div class="tooltip-title" id="tooltip-title">-</div>
                                    <div class="tooltip-row tooltip-number-row"><span class="tooltip-label">番号</span><span id="tooltip-number">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">装備名</span><span id="tooltip-name">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">効果</span><span id="tooltip-effect">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">使用可能タイミング</span><span id="tooltip-timing">-</span></div>
                                </div>
                            </div>
                            <div class="deck-panel game-only" id="deck-panel">
                                <span class="deck-label">山札に含まれる数字</span>
                                <ul class="deck-list" id="deck-list"></ul>
                            </div>
                        </div>
                        <div class="guess-panel guess-panel-inline" id="guess-panel">
                            <div class="guess-title" id="guess-title">このコードの数字を推測してください</div>
                            <div class="guess-list" id="guess-list"></div>
                        </div>
                        <div class="hand-slot" id="hand-container-3">
                            <span class="hand-label" id="hand-label-3"></span>
                            <span class="parent-icon" id="parent-icon-3" aria-label="隊長">👑</span>
                            <span class="hand-name" id="player-name-3">未参加</span>
                            <ul class="hand-list" id="hand-slot-3"></ul>
                            <button type="button" class="hand-detector" id="detector-3" aria-label="フツーノ探知機" data-equipment-number="0">
                                <img class="detector-icon" src="/img/image0.png" alt="">
                                <span class="sr-only">フツーノ探知機</span>
                                <div class="equipment-tooltip detector-tooltip" role="tooltip" aria-hidden="true">
                                    <div class="tooltip-title">-</div>
                                    <div class="tooltip-row tooltip-number-row"><span class="tooltip-label">番号</span><span class="detector-tooltip-number">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">装備名</span><span class="detector-tooltip-name">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">効果</span><span class="detector-tooltip-effect">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">使用可能タイミング</span><span class="detector-tooltip-timing">-</span></div>
                                </div>
                            </button>
                        </div>
                        <div class="hand-slot" id="hand-container-4">
                            <span class="hand-label" id="hand-label-4"></span>
                            <span class="parent-icon" id="parent-icon-4" aria-label="隊長">👑</span>
                            <span class="hand-name" id="player-name-4">未参加</span>
                            <ul class="hand-list" id="hand-slot-4"></ul>
                            <button type="button" class="hand-detector" id="detector-4" aria-label="フツーノ探知機" data-equipment-number="0">
                                <img class="detector-icon" src="/img/image0.png" alt="">
                                <span class="sr-only">フツーノ探知機</span>
                                <div class="equipment-tooltip detector-tooltip" role="tooltip" aria-hidden="true">
                                    <div class="tooltip-title">-</div>
                                    <div class="tooltip-row tooltip-number-row"><span class="tooltip-label">番号</span><span class="detector-tooltip-number">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">装備名</span><span class="detector-tooltip-name">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">効果</span><span class="detector-tooltip-effect">-</span></div>
                                    <div class="tooltip-row"><span class="tooltip-label">使用可能タイミング</span><span class="detector-tooltip-timing">-</span></div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-overlay" id="equipment-modal" aria-hidden="true">
                    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="equipment-modal-title">
                        <h2 class="modal-title" id="equipment-modal-title">装備カード</h2>
                        <p class="modal-message" id="equipment-modal-message">-</p>
                        <div class="modal-actions">
                            <button type="button" class="modal-button modal-cancel" id="equipment-modal-cancel">いいえ</button>
                            <button type="button" class="modal-button modal-confirm" id="equipment-modal-confirm">はい</button>
                        </div>
                    </div>
                </div>

                <div class="modal-overlay" id="swap-modal" aria-hidden="true">
                    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="swap-modal-title">
                        <h2 class="modal-title" id="swap-modal-title">コード交換</h2>
                        <p class="modal-message" id="swap-modal-message">-</p>
                        <div class="modal-actions">
                            <button type="button" class="modal-button modal-confirm" id="swap-modal-confirm">OK</button>
                        </div>
                    </div>
                </div>
                <div class="modal-overlay" id="radar-modal" aria-hidden="true">
                    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="radar-modal-title">
                        <h2 class="modal-title" id="radar-modal-title">なんでもレーダー</h2>
                        <p class="modal-message" id="radar-modal-message">-</p>
                        <div class="modal-actions">
                            <button type="button" class="modal-button modal-confirm" id="radar-modal-confirm">OK</button>
                        </div>
                    </div>
                </div>

                <div class="modal-overlay" id="release-notes-modal" aria-hidden="true">
                    <div class="modal-card release-notes-card" role="dialog" aria-modal="true" aria-labelledby="release-notes-title">
                        <h2 class="modal-title" id="release-notes-title">リリースノート v1.0.1</h2>
                        <div class="modal-message release-notes-body">
                            <ul class="release-notes-list">
                                <li>スマホ縦画面でのレイアウトとパネル折り返しを改善</li>
                                <li>手札/装備/デッキの横スクロールと表示安定性を向上</li>
                                <li>探知機の表示・ハイライト・宣言バブル表示を改善</li>
                                <li>ログ機能を追加（時刻付き・公開内容も表示）</li>
                                <li>ログアウト/接続周りのUIを微調整</li>
                                <li>装備3の使用タイミングを自分の手番に限定</li>
                                <li>装備10の宣言内容もバブルに表示</li>
                                <li>その他細かな修正</li>
                            </ul>
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="modal-button modal-confirm" id="release-notes-close">閉じる</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div class="modal-overlay" id="equipment-target-modal" aria-hidden="true">
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="equipment-target-title">
            <h2 class="modal-title" id="equipment-target-title">相手を選択</h2>
            <p class="modal-message" id="equipment-target-message">入れ替え先のプレイヤーを選んでください。</p>
            <div class="modal-actions" id="equipment-target-buttons"></div>
                        <div class="modal-actions">
                            <button type="button" class="modal-button modal-confirm" id="equipment-target-confirm">完了</button>
                        </div>
        </div>
    </div>

    <script th:src="@{/webjars/sockjs-client/sockjs.min.js}"></script>
    <script th:src="@{/webjars/stomp-websocket/stomp.min.js}"></script>
    <script th:src="@{/js/bomb-busters-play.js}"></script>
</body>
</html>
